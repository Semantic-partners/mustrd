SELECT ?s WHERE {
    ?s <test:p1> ?o1 ;
    FILTER NOT EXISTS {
        {
            ?o1 <test:p2> ?o2 .
        } UNION {
            ?o1 <test:p3> ?o3 .
        }
    }
}